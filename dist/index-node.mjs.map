{"version":3,"file":"index-node.mjs","sources":["../src/buildGetJSONWithFetch.js","../src/getDirectoryForURL.js","../src/index-node.mjs"],"sourcesContent":["/* eslint-disable node/no-unsupported-features/es-syntax */\n\n/**\n * @callback getJSONCallback\n * @param {string|string[]} jsonURL\n * @param {SimpleJSONCallback} cb\n * @param {SimpleJSONErrback} errBack\n * @returns {Promise<JSON>}\n */\n\n/**\n * @param {PlainObject} cfg\n * @param {fetch} cfg.fetch\n * @returns {getJSONCallback}\n */\nfunction buildGetJSONWithFetch ({\n  // eslint-disable-next-line no-shadow\n  fetch = window.fetch\n} = {}) {\n  /**\n  * @callback SimpleJSONCallback\n  * @param {JSON} json\n  * @returns {void}\n  */\n\n  /**\n  * @callback SimpleJSONErrback\n  * @param {Error} err\n  * @param {string|string[]} jsonURL\n  * @returns {void}\n  */\n\n  /**\n  * @type {getJSONCallback}\n  */\n  return async function getJSON (jsonURL, cb, errBack) {\n    try {\n      if (Array.isArray(jsonURL)) {\n        const arrResult = await Promise.all(jsonURL.map((url) => {\n          return getJSON(url);\n        }));\n        if (cb) {\n          // eslint-disable-next-line node/callback-return, standard/no-callback-literal, promise/prefer-await-to-callbacks\n          cb(...arrResult);\n        }\n        return arrResult;\n      }\n      const resp = await fetch(jsonURL);\n      const result = await resp.json();\n      // eslint-disable-next-line promise/prefer-await-to-callbacks\n      return typeof cb === 'function' ? cb(result) : result;\n    } catch (e) {\n      e.message += ` (File: ${jsonURL})`;\n      if (errBack) {\n        return errBack(e, jsonURL);\n      }\n      throw e;\n    }\n  };\n}\n\nexport {buildGetJSONWithFetch};\n","/* eslint-disable node/no-unsupported-features/node-builtins,\n  node/no-unsupported-features/es-syntax, compat/compat */\n\nimport {dirname} from 'path';\n\nconst isWindows = process.platform === 'win32';\n\n/**\n * @param {string} path\n * @returns {string}\n */\nfunction fixWindowsPath (path) {\n  return path.slice(\n    // istanbul ignore next\n    isWindows ? 1 : 0\n  );\n}\n\n/**\n * @param {string} url\n * @returns {string}\n */\nfunction getDirectoryForURL (url) {\n  // Node should be ok with this, but transpiling\n  //  to `require` doesn't work, so detect Windows\n  //  to remove slash instead\n  // \"file://\" +\n  return fixWindowsPath(\n    dirname(new URL(url).pathname)\n  );\n}\n\nexport {getDirectoryForURL};\n","/* eslint-disable node/no-unsupported-features/es-syntax */\nimport nodeFetch from 'node-fetch';\nimport {buildGetJSONWithFetch} from './buildGetJSONWithFetch.js';\nimport {getDirectoryForURL} from './getDirectoryForURL.js';\n\n/**\n * @param {PlainObject} cfg\n * @param {string} cfg.baseURL\n * @param {string} cfg.cwd\n * @returns {getJSONCallback}\n */\nfunction buildGetJSON ({\n  baseURL,\n  cwd: basePath = baseURL\n    ? getDirectoryForURL(baseURL)\n    : typeof fetch === 'undefined' && process.cwd()\n} = {}) {\n  const _fetch = typeof fetch !== 'undefined'\n    ? fetch\n    : (jsonURL) => {\n      if ((/^https?:/u).test(jsonURL)) {\n        return nodeFetch(jsonURL);\n      }\n      // Filed https://github.com/bergos/file-fetch/issues/12 to see\n      //  about getting relative basePaths in `file-fetch` and using\n      //  that better-tested package instead\n      // eslint-disable-next-line promise/avoid-new\n      return new Promise((resolve, reject) => {\n        // eslint-disable-next-line node/global-require, no-shadow\n        const XMLHttpRequest = require('local-xmlhttprequest')({\n          basePath\n        }); // Don't change to an import as won't resolve for browser testing\n        const r = new XMLHttpRequest();\n        r.open('GET', jsonURL, true);\n        // r.responseType = 'json';\n        r.onreadystatechange = function () {\n          // Not sure how to simulate\n          // istanbul ignore if\n          if (r.readyState !== 4) { return; }\n          if (r.status === 200) {\n            // var json = r.json;\n            const response = r.responseText;\n            resolve({\n              json: () => JSON.parse(response)\n            });\n            return;\n          }\n          reject(new SyntaxError(\n            'Failed to fetch URL: ' + jsonURL + 'state: ' +\n            r.readyState + '; status: ' + r.status\n          ));\n        };\n        r.send();\n      });\n    };\n\n  const ret = buildGetJSONWithFetch({\n    fetch: _fetch\n  });\n\n  ret._fetch = _fetch;\n  ret.hasURLBasePath = Boolean(baseURL);\n  ret.basePath = basePath;\n\n  return ret;\n}\n\nconst getJSON = buildGetJSON();\n\nexport {getJSON, buildGetJSON};\n"],"names":["value","then","direct","Promise","resolve","body","result","recover","e","buildGetJSONWithFetch","fetch","window","getJSON","jsonURL","cb","errBack","Array","isArray","all","map","url","arrResult","resp","json","message","isWindows","process","platform","fixWindowsPath","path","slice","getDirectoryForURL","dirname","URL","pathname","buildGetJSON","baseURL","cwd","basePath","_fetch","test","nodeFetch","reject","XMLHttpRequest","require","r","open","onreadystatechange","readyState","status","response","responseText","JSON","parse","SyntaxError","send","ret","hasURLBasePath","Boolean"],"mappings":"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"}