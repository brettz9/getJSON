{"version":3,"file":"index-polyglot.mjs","sources":["../src/buildGetJSONWithFetch.js","../src/getDirectoryForURL.js","../src/index-polyglot.js"],"sourcesContent":["/* eslint-disable node/no-unsupported-features/es-syntax */\n\n/**\n * @callback getJSONCallback\n * @param {string|string[]} jsonURL\n * @param {SimpleJSONCallback} cb\n * @param {SimpleJSONErrback} errBack\n * @returns {Promise<JSON>}\n */\n\n/**\n * @param {PlainObject} cfg\n * @param {fetch} cfg.fetch\n * @returns {getJSONCallback}\n */\nfunction buildGetJSONWithFetch ({\n  // eslint-disable-next-line no-shadow\n  fetch = window.fetch\n} = {}) {\n  /**\n  * @callback SimpleJSONCallback\n  * @param {JSON} json\n  * @returns {void}\n  */\n\n  /**\n  * @callback SimpleJSONErrback\n  * @param {Error} err\n  * @param {string|string[]} jsonURL\n  * @returns {void}\n  */\n\n  /**\n  * @type {getJSONCallback}\n  */\n  return async function getJSON (jsonURL, cb, errBack) {\n    try {\n      if (Array.isArray(jsonURL)) {\n        const arrResult = await Promise.all(jsonURL.map((url) => {\n          return getJSON(url);\n        }));\n        if (cb) {\n          // eslint-disable-next-line node/callback-return, standard/no-callback-literal, promise/prefer-await-to-callbacks\n          cb(...arrResult);\n        }\n        return arrResult;\n      }\n      const resp = await fetch(jsonURL);\n      const result = await resp.json();\n      return typeof cb === 'function'\n        // eslint-disable-next-line promise/prefer-await-to-callbacks\n        ? cb(result)\n        : result;\n    // https://github.com/bcoe/c8/issues/135\n    /* c8 ignore next */\n    } catch (e) {\n      e.message += ` (File: ${jsonURL})`;\n      if (errBack) {\n        return errBack(e, jsonURL);\n      }\n      throw e;\n    // https://github.com/bcoe/c8/issues/135\n    /* c8 ignore next */\n    }\n  };\n}\n\nexport {buildGetJSONWithFetch};\n","/* eslint-disable node/no-unsupported-features/node-builtins,\n  node/no-unsupported-features/es-syntax, compat/compat */\n\n// Needed for polyglot support (no `path` in browser); even if\n//  polyglot using dynamic `import` not supported by Rollup (complaining\n//  of inability to do tree-shaking in UMD builds), still useful to delay\n//  path import for our testing, so that test can import this file in\n//  the browser without compilation without it choking\nlet dirname, isWindows;\nexport const setDirname = async () => {\n  if (!dirname) {\n    ({dirname} = await import('path'));\n  }\n};\n\n/**\n * @param {string} path\n * @returns {string}\n */\nfunction fixWindowsPath (path) {\n  if (!isWindows) {\n    isWindows = process.platform === 'win32';\n  }\n  return path.slice(\n    // https://github.com/bcoe/c8/issues/135\n    /* c8 ignore next */\n    isWindows ? 1 : 0\n  );\n}\n\n/**\n * @param {string} url\n * @returns {string}\n */\nfunction getDirectoryForURL (url) {\n  // Node should be ok with this, but transpiling\n  //  to `require` doesn't work, so detect Windows\n  //  to remove slash instead\n  // \"file://\" +\n  return fixWindowsPath(\n    dirname(new URL(url).pathname)\n  );\n}\n\nexport {getDirectoryForURL};\n","/* eslint-disable node/no-unsupported-features/es-syntax */\nimport {buildGetJSONWithFetch} from './buildGetJSONWithFetch.js';\nimport {getDirectoryForURL, setDirname} from './getDirectoryForURL.js';\n\nlet nodeFetch;\n/**\n * @param {PlainObject} cfg\n * @param {string} cfg.baseURL\n * @param {string} cfg.cwd\n * @returns {getJSONCallback}\n */\nfunction buildGetJSON ({\n  baseURL,\n  cwd: basePath\n} = {}) {\n  const _fetch = typeof fetch !== 'undefined'\n    ? fetch\n    : async (jsonURL) => {\n      if ((/^https?:/u).test(jsonURL)) {\n        if (!nodeFetch) {\n          nodeFetch = await import('node-fetch');\n        }\n        return nodeFetch.default(jsonURL);\n      }\n\n      if (!basePath) {\n        await setDirname();\n        basePath = baseURL\n          ? getDirectoryForURL(baseURL)\n          : typeof fetch === 'undefined' && process.cwd();\n      }\n\n      // Filed https://github.com/bergos/file-fetch/issues/12 to see\n      //  about getting relative basePaths in `file-fetch` and using\n      //  that better-tested package instead\n      const localXMLHttpRequest = await import('local-xmlhttprequest');\n      // eslint-disable-next-line no-shadow\n      const XMLHttpRequest = localXMLHttpRequest.default({\n        basePath\n      }); // Don't change to an import as won't resolve for browser testing\n      // eslint-disable-next-line promise/avoid-new\n      return new Promise((resolve, reject) => {\n        const r = new XMLHttpRequest();\n        r.open('GET', jsonURL, true);\n        // r.responseType = 'json';\n        r.onreadystatechange = function () {\n          // Not sure how to simulate `if`\n          /* c8 ignore next */\n          if (r.readyState !== 4) { return; }\n          if (r.status === 200) {\n            // var json = r.json;\n            const response = r.responseText;\n            resolve({\n              json: () => JSON.parse(response)\n            });\n            return;\n          }\n          reject(new SyntaxError(\n            'Failed to fetch URL: ' + jsonURL + 'state: ' +\n            r.readyState + '; status: ' + r.status\n          ));\n        };\n        r.send();\n      // https://github.com/bcoe/c8/issues/135\n      /* c8 ignore next */\n      });\n    };\n\n  const ret = buildGetJSONWithFetch({\n    fetch: _fetch\n  });\n\n  ret._fetch = _fetch;\n  ret.hasURLBasePath = Boolean(baseURL);\n  ret.basePath = basePath;\n\n  return ret;\n}\n\nconst getJSON = buildGetJSON();\n\nexport {getJSON, buildGetJSON};\n"],"names":["value","then","direct","Promise","resolve","body","result","recover","e","buildGetJSONWithFetch","fetch","window","getJSON","jsonURL","cb","errBack","Array","isArray","all","map","url","arrResult","resp","json","message","dirname","isWindows","f","args","i","arguments","length","apply","reject","setDirname","fixWindowsPath","path","process","platform","slice","getDirectoryForURL","URL","pathname","_await","nodeFetch","buildGetJSON","baseURL","cwd","basePath","_fetch","test","default","localXMLHttpRequest","XMLHttpRequest","r","open","onreadystatechange","readyState","status","response","responseText","JSON","parse","SyntaxError","send","ret","hasURLBasePath","Boolean"],"mappings":"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"}